<html>
  <head>
    <meta lang="jp" name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Location-based AR.jsのテスト</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>

  </head>

  <body style="margin: 0; overflow: hidden;">
    <a-scene
      vr-mode-ui="enabled: false"
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
    >

      <a-assets>
        <img id="unknown" src="loading.gif" title="unknown">
        <img id="sunny" src="MBSL23-003-0.png" title="sunny">
        <img id="cloudy" src="cloudy.png" title="cloudy">
        <img id="rainy" src="MSRD23-003-0.png" title="rain">
        <img id="snowy" src="snowy.png" title="snowy">
      </a-assets>

      <a-entity id="weather-text-anchor"
        gps-entity-place="latitude: 35.7046486; longitude: 139.6383561;">
      </a-entity>

      <!-- カメラ -->
      <a-camera gps-camera="minDistance: 10" rotation-reader> </a-camera>
    </a-scene>
  </body>
  <script>
      window.addEventListener('load', () => {
        // 適当に場所を指定して緯度、経度を指定
        const lat = 35.7046486;
        const lon = 139.6383561;
        const apiKey = "85d58a3e59a7469a65d625479f26ff17";

        fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`)
          .then(response => response.json())
          .then(data => {
            const weather = data.weather[0].main;
            const anchor = document.getElementById('weather-text-anchor');
            const imageEl = document.createElement('a-image');

            let imgId = "#unknown"; // デフォルト画像

            switch (weather) {
              case "Clear":
                imgId = "#sunny";
                break;
              case "Clouds":
                imgId = "#cloudy";
                break;
              case "Rain":
                imgId = "#rainy";
                break;
              case "Snow":
                imgId = "#snowy";
                break;
            }

            imageEl.setAttribute('src', imgId);
            imageEl.setAttribute('position', '0 100 0');  // 高さは適宜調整
            imageEl.setAttribute('scale', '10 10 10');
            imageEl.setAttribute('title', weather);

            anchor.appendChild(imageEl);
          });
      });
  </script>
</html>
